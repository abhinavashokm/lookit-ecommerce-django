{% extends 'user_base/base.html' %}
{% load static %}
{% block styles %}
<link rel="stylesheet" href="{% static 'admin/css/components/pagination.css' %}">
<link rel="stylesheet" href="{% static 'core/css/explore.css' %}">
{% endblock %}

<!-- Main Content -->
{% block content %}
<div class="main-container">
    <!-- Filter Sidebar -->
    <aside class="filter-sidebar">
        <h2 class="filter-title">Filter By</h2>

        <!--FILTER FORM DESKTOP (there is a seperate form for mobile devices)-->
        <form action="{% url 'explore' %}" method="get" id="filterForm">

            <!--for preserving query params of search and sort-->
            <input type="hidden" name="sort" value="{{ request.GET.sort }}">
            <input type="hidden" name="search" value="{{ request.GET.search }}">

            <!-- Styles Filter -->
            <div class="filter-group">
                <label for="styles">Styles</label>
                <div class="searchable-dropdown" id="stylesDropdown">
                    <input type="text" class="searchable-dropdown-input" id="stylesInput" placeholder="All Styles"
                        value="{{ request.GET.style }}" readonly>
                    <input type="hidden" id="stylesValue" name="style" value="{{ request.GET.style }}">
                    <svg class="searchable-dropdown-arrow" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#333" d="M6 9L1 4h10z" />
                    </svg>
                    <div class="searchable-dropdown-options">
                        <div class="searchable-dropdown-search">
                            <input type="text" placeholder="Search styles..." id="stylesSearch">
                        </div>
                        <div class="searchable-dropdown-option" data-value="" data-text="All Styles">All Styles</div>
                        {% for style in styles %}
                        <div class="searchable-dropdown-option" data-value="{{ style.name }}" data-text="{{ style.name }}">{{ style.name }}</div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Color Filter -->
            <div class="filter-group">
                <label for="color">Color</label>
                <select id="color" name="color" class="filter-select">
                    <option value="">All Colors</option>
                    <option value="black" {% if request.GET.color == 'black' %}selected{% endif %}>Black</option>
                    <option value="white" {% if request.GET.color == 'white' %}selected{% endif %}>White</option>
                    <option value="red" {% if request.GET.color == 'red' %}selected{% endif %}>Red</option>
                    <option value="blue" {% if request.GET.color == 'blue' %}selected{% endif %}>Blue</option>
                    <option value="green" {% if request.GET.color == 'green' %}selected{% endif %}>Green</option>
                    <option value="gray" {% if request.GET.color == 'gray' %}selected{% endif %}>Gray</option>
                </select>
            </div>

            <!-- Size Filter -->
            <div class="filter-group">
                <label for="size">Size</label>
                <select id="size" name="size" class="filter-select">
                    <option value="">All Sizes</option>
                    <option value="xs" {% if request.GET.size == 'xs' %}selected{% endif %}>XS</option>
                    <option value="s" {% if request.GET.size == 's' %}selected{% endif %}>S</option>
                    <option value="m" {% if request.GET.size == 'm' %}selected{% endif %}>M</option>
                    <option value="l" {% if request.GET.size == 'l' %}selected{% endif %}>L</option>
                    <option value="xl" {% if request.GET.size == 'xl' %}selected{% endif %}>XL</option>
                    <option value="xxl" {% if request.GET.size == 'xxl' %}selected{% endif %}>XXL</option>
                </select>
            </div>

            <!-- Price Range Filter -->
            <div class="filter-group">
                <label for="priceRange">Price Range</label>
                <div class="price-range-container">
                    <div class="price-range-wrapper">
                        <div class="price-range-active" id="priceRangeActive"></div>
                        <input type="range" id="priceRangeMin" name="price_min"
                            class="price-range-slider price-range-slider-min" min="0" max="5000" value="{%if request.GET.price_min %}{{ request.GET.price_min }}{% else %}0{% endif %}" step="100">
                        <input type="range" id="priceRangeMax" name="price_max"
                            class="price-range-slider price-range-slider-max" min="0" max="5000" value="{%if request.GET.price_max %}{{ request.GET.price_max }}{% else %}5000{% endif %}"
                            step="100">
                    </div>
                    <div class="price-display">
                        <span id="priceMinDisplay">₹{{ request.GET.price_min }}</span>
                        <span id="priceMaxDisplay">₹{{ request.GET.price_max }}</span>
                    </div>
                </div>
            </div>

            <!-- Filter Buttons -->
            <div class="filter-buttons">
                <a href="{% url 'explore' %}">
                    <button type="button" class="clear-btn">Clear All</button>
                </a>
                <button type="submit" class="apply-btn">Apply Filters</button>
            </div>

        </form>

    </aside>

    <!-- Product Content Area -->
    <main class="product-content">
        <div class="content-header">
            <h1 class="content-title">
                Explore our collection
                <span class="title-badge">All</span>
            </h1>

            <!--SEARCH SECTION-->
            <div class="search-container">
                <form method="GET" action="{% url 'explore' %}" id="searchForm">

                    <!-- hidden inputs to preserve other query params -->
                    <input type="hidden" name="sort" value="{{ request.GET.sort }}">
                    <input type="hidden" name="style" value="{{ request.GET.style }}">
                    <input type="hidden" name="color" value="{{ request.GET.color }}">
                    <input type="hidden" name="size" value="{{ request.GET.size }}">
                    <input type="hidden" name="priceMin" value="{{ request.GET.priceMin }}">
                    <input type="hidden" name="priceMax" value="{{ request.GET.priceMax }}">

                    <input type="text" placeholder="Search" id="searchInput" name="search"
                        value="{{ request.GET.search }}">
                    <!--clear button-->
                    <a
                        href="{% url 'explore' %}?sort={{ request.GET.sort }}&styles={{ request.GET.style }}&color={{ request.GET.color }}&size={{ request.GET.size }}&priceMin={{ request.GET.priceMin }}&priceMax={{ request.GET.priceMax }}">
                        <button type="button" class="search-clear-btn {% if request.GET.search %}visible{% endif %}"
                            id="searchClearBtn" title="Clear">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                            </svg>
                        </button>
                    </a>
                    <!--submit button-->
                    <button type="submit" class="search-submit-btn" title="Search">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                        </svg>
                    </button>
                </form>
            </div>

        </div>

        <!-- Sort Buttons -->
        <div class="sort-container">
            <div class="sort-group">
                <span class="sort-label" style="font-size: 0.85rem;">Price:</span>
                <a
                    href="{% url 'explore' %}?sort=price&search={{ request.GET.search }}&styles={{ request.GET.style }}&color={{ request.GET.color }}&size={{ request.GET.size }}&priceMin={{ request.GET.priceMin }}&priceMax={{ request.GET.priceMax }}">
                    <button class="sort-btn {% if request.GET.sort == 'price' %}active{% endif %}">Low to High</button>
                </a>
                <a
                    href="{% url 'explore' %}?sort=-price&search={{ request.GET.search }}&styles={{ request.GET.style }}&color={{ request.GET.color }}&size={{ request.GET.size }}&priceMin={{ request.GET.priceMin }}&priceMax={{ request.GET.priceMax }}">
                    <button class="sort-btn {% if request.GET.sort == '-price' %}active{% endif %}">High to Low</button>
                </a>
            </div>
            <div class="sort-group">
                <span class="sort-label" style="font-size: 0.85rem;">Name:</span>
                <a
                    href="{% url 'explore' %}?sort=name&search={{ request.GET.search }}&styles={{ request.GET.style }}&color={{ request.GET.color }}&size={{ request.GET.size }}&priceMin={{ request.GET.priceMin }}&priceMax={{ request.GET.priceMax }}">
                    <button class="sort-btn {% if request.GET.sort == 'name' %}active{% endif %}">A-Z</button>
                </a>
                <a
                    href="{% url 'explore' %}?sort=-name&search={{ request.GET.search }}&styles={{ request.GET.style }}&color={{ request.GET.color }}&size={{ request.GET.size }}&priceMin={{ request.GET.priceMin }}&priceMax={{ request.GET.priceMax }}">
                    <button class="sort-btn {% if request.GET.sort == '-name' %}active{% endif %}">Z-A</button>
                </a>
            </div>
        </div>

        <!-- Mobile Filter Toggle Button -->
        <button class="filter-toggle-btn" id="filterToggleBtn">
            <span>Filter By</span>
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>

        <!-- Filter Sidebar (Mobile - appears after toggle) -->
        <aside class="filter-sidebar" id="mobileFilterSidebar">
            <h2 class="filter-title">Filter By</h2>

            <form action="{url 'explore'}" method="get" id="mobileFilterForm">
                <input type="hidden" name="sort" value="{{ request.GET.sort }}">

                <!-- Styles Filter -->
                <div class="filter-group">
                    <label for="styles">Styles</label>
                    <div class="searchable-dropdown" id="stylesDropdownMobile">
                        <input type="text" class="searchable-dropdown-input" id="stylesInputMobile" name="style"
                            placeholder="All Styles" readonly>
                        <input type="hidden" id="stylesValueMobile" name="style" value="">
                        <svg class="searchable-dropdown-arrow" viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg">
                            <path fill="#333" d="M6 9L1 4h10z" />
                        </svg>
                        <div class="searchable-dropdown-options">
                            <div class="searchable-dropdown-search">
                                <input type="text" placeholder="Search styles..." id="stylesSearchMobile">
                            </div>
                            <div class="searchable-dropdown-option" data-value="" data-text="All Styles">All Styles
                            </div>
                            <div class="searchable-dropdown-option" data-value="polo" data-text="Polo">Polo</div>
                            <div class="searchable-dropdown-option" data-value="oversized" data-text="Oversized">
                                Oversized</div>
                            <div class="searchable-dropdown-option" data-value="plain" data-text="Plain">Plain</div>
                        </div>
                    </div>
                </div>

                <!-- Color Filter -->
                <div class="filter-group">
                    <label for="color">Color</label>
                    <select id="color" name="color" class="filter-select">
                        <option value="">All Colors</option>
                        <option value="black">Black</option>
                        <option value="white">White</option>
                        <option value="red">Red</option>
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="gray">Gray</option>
                    </select>
                </div>

                <!-- Size Filter -->
                <div class="filter-group">
                    <label for="size">Size</label>
                    <select id="size" name="size" class="filter-select">
                        <option value="">All Sizes</option>
                        <option value="xs">XS</option>
                        <option value="s">S</option>
                        <option value="m">M</option>
                        <option value="l">L</option>
                        <option value="xl">XL</option>
                        <option value="xxl">XXL</option>
                    </select>
                </div>

                <!-- Price Range Filter -->
                <div class="filter-group">
                    <label for="priceRange">Price Range</label>
                    <div class="price-range-container">
                        <div class="price-range-wrapper">
                            <div class="price-range-active" id="priceRangeActiveMobile"></div>
                            <input type="range" id="priceRangeMinMobile" name="priceMin"
                                class="price-range-slider price-range-slider-min" min="0" max="5000" value="500"
                                step="100">
                            <input type="range" id="priceRangeMaxMobile" name="priceMax"
                                class="price-range-slider price-range-slider-max" min="0" max="5000" value="2500"
                                step="100">
                        </div>
                        <div class="price-display">
                            <span id="priceMinDisplayMobile">₹500</span>
                            <span id="priceMaxDisplayMobile">₹2500</span>
                        </div>
                    </div>
                </div>

                <!-- Filter Buttons -->
                <div class="filter-buttons">
                    <a href="{% url 'explore' %}">
                        <button type="button" class="clear-btn">Clear All</button>
                    </a>
                    <button type="submit" class="apply-btn">Apply Filters</button>
                </div>
            </form>
        </aside>

        <div class="product-grid">

            {% for product in page_obj %}
            <a style="text-decoration: none;" href="{% url 'product-details' %}">
            <div class="product-card">
                <div class="product-image" style="background: linear-gradient(135deg, #f5e6d3, #e8d5c0);"></div>
                <div class="product-info">
                    <h3 class="product-title">{{ product.name }}</h3>
                    <p class="product-price">
                        ₹{{ product.price }}
                        <button class="wishlist-btn" onclick="this.classList.toggle('active')">
                            <svg class="heart-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                            </svg>
                        </button>
                    </p>
                </div>
            </div>
            </a>
            {% endfor %}

        </div>

        <!-- Pagination -->
        {% include 'admin_base/components/pagination.html' %}

    </main>
</div>

{% endblock %}

{% block scripts %}
<script src="{% static 'core/js/explore.js' %}"></script>
{% endblock %}