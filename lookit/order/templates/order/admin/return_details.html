{% extends 'admin_base/base.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'order/css/admin/return_details.css' %}">
<link rel="stylesheet" href="{% static 'admin/css/components/pagination.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

{% block content %}
<main class="main-content">
  <!-- Breadcrumb + Title -->
  <div class="page-header">
    <div class="breadcrumbs">
      <a href="">Return Requests</a>
      <span>/</span>
      <span>View Return</span>
    </div>
    <h1 class="page-title">Return Request Details</h1>
  </div>

  <div class="order-details-container">

    <!-- 1️⃣ RETURN SUMMARY -->
    <div class="order-card">
      <div class="card-header">
        <h2>Return Summary</h2>
      </div>
      <div class="card-body return-summary">
        <div class="summary-row">
          <span class="summary-label">Linked Order Id</span>
          <span class="summary-value">#ORD-0123</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Amount Paid</span>
          <span class="summary-value">₹{{ order.total }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Refund Method</span>
          <span class="summary-value">Wallet</span>
        </div>
        <div class="summary-row status">
          <span class="summary-label">Return Status</span>
          <span class="status-badge status-approved">{{ return_request.status }}</span>
        </div>
      </div>
    </div>

    <!-- 2️⃣ PRODUCT & ORDER DETAILS -->
    <div class="order-card">
      <div class="card-header">
        <h2>Product Information</h2>
      </div>
      <div class="card-body">
        <table class="product-table">
          <thead>
            <tr>
              <th>Image</th>
              <th>Product</th>
              <th>Variant</th>
              <th>Quantity</th>
              <th>Base Price</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><img style="max-height: 75px;" src="{{ order.product.image_url }}" alt="Product"></td>
              <td>{{ order.product.name }}</td>
              <td>{{ order.variant.size }}</td>
              <td>{{ order.quantity }}</td>
              <td>₹{{ order.unit_price }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 3️⃣ RETURN REASON & EVIDENCE -->
    <div class="order-card">
      <div class="card-header">
        <h2><i class="fas fa-info-circle"></i> Return Reason & Evidence</h2>
      </div>
      <div class="card-body">
        <div class="info-item">
          <span class="info-label"><i class="fas fa-quote-left"></i> Reason</span>
          <span class="info-value important">{{ return_request.reason }}</span>
        </div>
        <div class="info-item">
          <span class="info-label"><i class="fas fa-comment"></i> Customer Comments</span>
          <span class="info-value">“{{ return_request.comments }}”</span>
        </div>
        <div class="info-item">
          <span class="info-label"><i class="fas fa-images"></i> Uploaded Images (up to 3)</span>
          <div class="return-images">
            {% if return_request.product_image1 %}
                <img src="{{ return_request.product_image1 }}" alt="Return Image 1">
            {% endif %}

            {% if return_request.product_image2 %}
                <img src="{{ return_request.product_image2 }}" alt="Return Image 2">
            {% endif %}

            {% if return_request.product_image3 %}
                <img src="{{ return_request.product_image3 }}" alt="Return Image 3">
            {% endif %}
           
          </div>
        </div>
      </div>
    </div>

    <!-- 4️⃣ PICKUP & CUSTOMER INFO -->
    <div class="info-cards-container">
      <!-- Pickup -->
      <div class="info-card">
        <div class="card-header">
          <h2><i class="fas fa-map-marker-alt"></i> Pickup Address</h2>
        </div>
        <div class="card-body">
          <div class="delivery-address">
            <div class="address-line"><i class="fas fa-user"></i> {{ address.full_name }}</div>
            <div class="address-line"><i class="fas fa-map"></i> {{ address.address_line }}</div>
            <div class="address-line"><i class="fas fa-city"></i> {{ address.city }}, {{ address.state }}, {{ address.pincode }}</div>
            <div class="address-line"><i class="fas fa-phone"></i> {{ address.phone }}{% if address.second_phone %}, {{ address.second_phone }}{% endif %}</div>
          </div>
        </div>
      </div>

      <!-- Customer -->
      <div class="info-card">
        <div class="card-header">
          <h2><i class="fas fa-user"></i> Customer Information</h2>
        </div>
        <div class="card-body">
          <div class="info-item"><span class="info-label">Name</span><span class="info-value">{{ customer.full_name }}</span></div>
          <div class="info-item"><span class="info-label">Email</span><span class="info-value">{{ customer.email }}</span></div>
          <div class="info-item"><span class="info-label">Phone</span><span class="info-value">{{ customer.phone }}</span></div>
        </div>
      </div>
    </div>

    <!-- 5️⃣ RETURN PROGRESS -->
    <div class="order-card">
      <div class="card-header">
        <h2><i class="fas fa-tasks"></i> Return Progress</h2>
      </div>
      <div class="card-body">
        <div class="timeline">
          <div class="timeline-item completed">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <h4>Return Requested</h4>
              <p>Dec 2, 2025 – 10:30 AM</p>
            </div>
          </div>
          <div class="timeline-item {% if return_request.status == 'APPROVED' %}active{% elif return_request.status == 'PICKED_UP' or return_request.status == 'REFUNDED' %}completed{% endif %}">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <h4>Approved</h4>
              <p>Dec 3, 2025 – 11:00 AM</p>
            </div>
          </div>
          <div class="timeline-item {% if return_request.status == 'PICKED_UP' %}active{% elif return_request.status == 'REFUNDED' %}completed{% endif %}">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <h4>Pickup Completed</h4>
              <p>Dec 4, 2025 – 09:00 AM</p>
            </div>
          </div>
          <div class="timeline-item {% if return_request.status == 'PICKED_UP' %}completed{% endif %}">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <h4>Refund Completed</h4>
              <p>Pending</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 6️⃣ ADMIN ACTIONS -->
    <div class="action-buttons">
      <button class="btn btn-primary" onclick="openStatusModal()">
        <i class="fas fa-edit"></i> Update Return Status
      </button>
      <button class="btn btn-danger">
        <i class="fas fa-times"></i> Reject Return
      </button>
    </div>
  </div>
</main>
<!-- Update Return Status Modal -->
<div id="statusModal" class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h3>Update Return Status</h3>
      <button class="close-btn" onclick="closeStatusModal()">&times;</button>
    </div>

    <form action="" method="post">
      {% csrf_token %}
      <div class="modal-body">
        <div class="order-info">
          <p><strong>Return ID:</strong> #RET-{{ return.id|stringformat:'04d' }}</p>
          <p><strong>Product:</strong> {{ return.order_item.variant.product.name }}</p>
        </div>

        <div class="form-group">
          <label for="statusSelect">New Status</label>
          <select name="status" id="statusSelect" class="form-control" required>
            <option value="" disabled selected>Select status</option>
            <option value="REQUESTED">Requested</option>
            <option value="APPROVED">Approved</option>
            <option value="PICKUP_SCHEDULED">Pickup Scheduled</option>
            <option value="PICKED_UP">Picked Up</option>
            <option value="REFUND_INITIATED">Refund Initiated</option>
            <option value="REFUNDED">Refund Completed</option>
            <option value="REJECTED">Rejected</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeStatusModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Update Status</button>
      </div>
    </form>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{% static 'order/js/admin/return_details.js' %}"></script>
{% endblock %}