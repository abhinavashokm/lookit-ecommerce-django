{% extends 'user_base/base.html' %}
{% load static %}
{% block styles %}
<link rel="stylesheet" href="{% static 'order/css/checkout.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block content %}

<!-- Main Content -->
<div class="container">
    <!-- Breadcrumbs -->
    <div class="breadcrumbs">
        <a href="{% url 'cart' %}">Shopping Cart</a>
        <span>/</span>
        <span>Checkout</span>
    </div>

    <!-- Order Summary -->
    <div class="order-summary">
        <h3>Order Summary</h3>
        <table class="product-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>

                {% for item in order_items %}
                <tr>
                    <td>
                        <div class="product-info">
                            <img src="{{ item.product.image_url }}" alt="Classic White Tee" class="product-image">
                            <div>
                                <div class="product-name">{{ item.product.name }}</div>
                                <div class="product-variant">Size: {{ item.variant.size }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="product-price">₹{{ item.product.price }}</td>
                    <td class="product-quantity">{{ item.quantity }}</td>
                    <td class="product-total">₹{{ item.sub_total_per_product }}</td>
                </tr>
                {% endfor %}

            </tbody>
        </table>
    </div>

    <div class="checkout-layout">
        <div class="delivery-address">
            <h3>Select Delivery Address</h3>
            <div class="address-options">

                {% for address in address_list %}
                <div class="address-option {% if address.is_default %}selected{% endif %}">
                    <input type="radio" name="delivery-address" id="address-1" class="address-radio" checked>
                    <div class="address-details">
                        <div class="address-header">
                            <div class="address-name">{{ address.full_name }}</div>
                            {% if address.is_default %}
                            <span class="default-badge">Default</span>
                            {% endif %}
                        </div>
                        <p class="address-text">{{ address.address_line }}, {{ address.city }}, {{ address.state }}, PIN: {{ address.pincode }}</p>
                        <div class="address-phone">{{ address.phone }}{% if address.second_phone %}, alter: {{ address.second_phone }}{% endif %}</div>
                        <div class="address-type">{{ address.type|upper }}</div>
                        <div class="address-actions">
                            <button class="edit-address" data-address-id="1">
                                <i class="far fa-edit"></i> Edit
                            </button>

                            <form action="{% url 'delete-address' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="address_id" value="{{ address.id }}">
                                <button class="remove-address" data-address-id="1">
                                    <i class="far fa-trash-alt"></i> Remove
                                </button>
                            </form>

                        </div>
                    </div>
                </div>
                {% endfor %}

            </div>
            <button class="add-address-btn">
                <i class="fas fa-plus"></i> Add New Address
            </button>
        </div>

        <div class="price-summary">
            <h3>Price Details</h3>
            <div class="price-row">
                <span>Total</span>
                <span class="price-value">₹{{ price_summary.sub_total }}</span>
            </div>
            <div class="price-row">
                <span>Delivery Fee</span>
                <span class="price-value">₹0.00</span>
            </div>
            {% if price_summary.discount %}
            <div class="price-row discount">
                <span>Discount</span>
                <span class="price-value">-₹10.00</span>
            </div>
            {% endif %}
            <div class="price-row">
                <span>GST & Taxes</span>
                <span class="price-value">₹{{ price_summary.tax }}</span>
            </div>
            <div class="price-row total">
                <span>Final Amount</span>
                <span class="price-value">₹{{ price_summary.grand_total }}</span>
            </div>
            <button class="checkout-btn">
                Continue to Payment
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>

    </div>
</div>

<!-- Add Address Modal -->
<div class="modal" id="addAddressModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-map-marker-alt"></i> Add New Address</h3>
            <button class="close-modal" aria-label="Close modal">&times;</button>
        </div>
        <div class="modal-body">

            <form action="{% url 'add-address' %}" method="post" id="addressForm">
                {% csrf_token %}
                <div class="form-section">
                    <h4 class="section-title">Contact Information</h4>
                    <div class="form-grid">

                        <div class="form-group">
                            <label for="fullName">Full Name <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <i class="fas fa-user"></i>
                                <input type="text" name="full_name" id="fullName" placeholder="John Doe" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">Phone Number <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <i class="fas fa-phone"></i>
                                <input type="tel" name="phone" id="phone" placeholder="+1 (555) 123-4567" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="altPhone">Alternative Phone</label>
                            <div class="input-with-icon">
                                <i class="fas fa-phone-alt"></i>
                                <input type="tel" name="second_phone" id="altPhone" placeholder="+1 (555) 987-6543">
                            </div>
                        </div>

                    </div>
                </div>

                <div class="form-section">
                    <h4 class="section-title">Address Details</h4>
                    <div class="form-grid">

                        <div class="form-group full-width">
                            <label for="address">Address Line <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <i class="fas fa-map-marked-alt"></i>
                                <input type="text" name="address_line" id="address" placeholder="123 Main St, Apt 4B" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="city">City <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <i class="fas fa-city"></i>
                                <input type="text" name="city" id="city" placeholder="New York" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="state">State <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <i class="fas fa-flag"></i>
                                <input type="text" name="state" id="state" placeholder="New York" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="zipCode">PIN Code <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <i class="fas fa-mail-bulk"></i>
                                <input type="text" name="pincode" id="zipCode" placeholder="10001" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="addressType">Address Type <span class="required">*</span></label>
                            <div class="select-wrapper">
                                <i class="fas fa-tag"></i>

                                <select name="type" id="addressType" required>
                                    <option value="" disabled selected>Select address type</option>
                                    <option value="home">Home</option>
                                    <option value="work">Work</option>
                                    <option value="other">Other</option>
                                </select>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-options">
                        <label class="checkbox-container">
                            <input name="is_default" value="True" type="checkbox" id="defaultAddress">
                            <span class="checkmark"></span>
                            Set as default shipping address
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-outline">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Address
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{% static 'order/js/checkout.js' %}"></script>
{% endblock %}